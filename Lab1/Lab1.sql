CREATE DATABASE COMPANY;
USE COMPANY;

CREATE TABLE EMPLOYEE (
    FNAME           VARCHAR(50) NOT NULL,
    LNAME           VARCHAR(50) NOT NULL,
    SSN             CHAR(9) PRIMARY KEY,
    BDATE           DATE,
    ADDRESS         VARCHAR(100),
    SALARY          DECIMAL(10,2),
    DNO             INT,
    SUPERVISOR_SSN  CHAR(9),
    PARTNER_SSN     CHAR(9),
    CONSTRAINT FK_SUPERVISOR FOREIGN KEY (SUPERVISOR_SSN) REFERENCES EMPLOYEE (SSN)
);

CREATE TABLE DEPARTMENT (
    DNAME           VARCHAR(50) NOT NULL UNIQUE,
    DNUMBER         INT PRIMARY KEY,
    MGR_SSN         CHAR(9),
    MGR_START_DATE  DATE,
    CONSTRAINT FK_MGR FOREIGN KEY (MGR_SSN) REFERENCES EMPLOYEE (SSN)
);

ALTER TABLE EMPLOYEE
    ADD CONSTRAINT FK_DEPT FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNUMBER);

CREATE TABLE DEPT_LOCATION (
    DNUMBER     INT,
    DLOCATION   VARCHAR(50),
    PRIMARY KEY (DNUMBER, DLOCATION),
    CONSTRAINT FK_DEPTLOC_DEPT FOREIGN KEY (DNUMBER) REFERENCES DEPARTMENT (DNUMBER)
);

CREATE TABLE PROJECT (
    PNAME       VARCHAR(50) NOT NULL,
    PNUMBER     INT PRIMARY KEY,
    PLOCATION   VARCHAR(50),
    DNUM        INT,
    CONSTRAINT FK_PROJ_DEPT FOREIGN KEY (DNUM) REFERENCES DEPARTMENT (DNUMBER)
);

CREATE TABLE WORK_ON (
    ESSN    CHAR(9),
    PNO     INT,
    HOURS   DECIMAL(5,2),
    PRIMARY KEY (ESSN, PNO),
    CONSTRAINT FK_WORK_EMP FOREIGN KEY (ESSN) REFERENCES EMPLOYEE (SSN),
    CONSTRAINT FK_WORK_PROJ FOREIGN KEY (PNO) REFERENCES PROJECT (PNUMBER)
);

CREATE TABLE DEPENDENT (
    ESSN            CHAR(9),
    DEPENDENT_NAME  VARCHAR(50),
    SEX             CHAR(1),
    BDATE           DATE,
    RELATIONSHIP    VARCHAR(25),
    PRIMARY KEY (ESSN, DEPENDENT_NAME),
    CONSTRAINT FK_DEP_EMP FOREIGN KEY (ESSN) REFERENCES EMPLOYEE (SSN)
);

INSERT INTO DEPARTMENT (DNAME, DNUMBER, MGR_SSN, MGR_START_DATE)
VALUES
    ('LOVE RESEARCH', 1, NULL, '2025-11-18'),
    ('ROMANCE ADMINISTRATION', 2, NULL, '2025-11-19');

INSERT INTO DEPT_LOCATION (DNUMBER, DLOCATION)
VALUES
    (1, 'TOKYO'),
    (1, 'KYOTO'),
    (2, 'OSAKA');

INSERT INTO EMPLOYEE (FNAME, LNAME, SSN, BDATE, ADDRESS, SALARY, DNO, SUPERVISOR_SSN, PARTNER_SSN)
VALUES
    ('KAGUYA', 'SHINOMIYA', '111111111', '1998-01-01', 'TOKYO ACADEMY', 75000, 1, NULL, NULL),
    ('MIYUKI', 'SHIROGANE', '222222222', '1997-03-09', 'STUDENT COUNCIL HALL', 82000, 1, '111111111', '333333333'),
    ('GOJO', 'WAKANA', '333333333', '1996-05-05', 'SHIBUYA DISTRICT', 95000, 2, NULL, NULL),
    ('MARIN', 'KITAGAWA', '444444444', '1999-07-07', 'HARAJUKU STREET', 60000, 2, '333333333', NULL),
    ('CHIKA', 'FUJIWARA', '555555555', '1998-12-12', 'KANDA SHRINE AREA', 70000, 1, '111111111', NULL);

INSERT INTO PROJECT (PNAME, PNUMBER, PLOCATION, DNUM)
VALUES
    ('PROJECT CONFESSION WAR', 101, 'TOKYO', 1),
    ('PROJECT COSPLAY HEARTS', 102, 'OSAKA', 2),
    ('PROJECT LOVE IS WAR', 103, 'KYOTO', 1);

INSERT INTO WORK_ON (ESSN, PNO, HOURS)
VALUES
    ('111111111', 101, 20.0),
    ('222222222', 101, 15.5),
    ('333333333', 102, 30.0),
    ('444444444', 102, 25.0),
    ('555555555', 103, 10.0);

INSERT INTO DEPENDENT (ESSN, DEPENDENT_NAME, SEX, BDATE, RELATIONSHIP)
VALUES
    ('111111111', 'AI HAYASAKA', 'F', '1999-02-14', 'ASSISTANT'),
    ('222222222', 'KEI SHIROGANE', 'F', '2005-06-01', 'SISTER'),
    ('333333333', 'GRANDPA GOJO', 'M', '1945-11-11', 'GRANDPARENT'),
    ('444444444', 'COSPLAY BUDDY', 'F', '2000-08-08', 'FRIEND'),
    ('555555555', 'DANCE PARTNER', 'M', '1998-09-09', 'FRIEND');

DROP TABLE WORK_ON;
DROP TABLE DEPENDENT;
DROP TABLE PROJECT;
DROP TABLE DEPT_LOCATION;
DROP TABLE EMPLOYEE;
DROP TABLE DEPARTMENT;
